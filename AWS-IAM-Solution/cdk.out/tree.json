{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.220.0"},"children":{"AwsIamSolutionStack":{"id":"AwsIamSolutionStack","path":"AwsIamSolutionStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.220.0"},"children":{"OrgConstruct":{"id":"OrgConstruct","path":"AwsIamSolutionStack/OrgConstruct","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Organization":{"id":"Organization","path":"AwsIamSolutionStack/OrgConstruct/Organization","constructInfo":{"fqn":"aws-cdk-lib.aws_organizations.CfnOrganization","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Organizations::Organization","aws:cdk:cloudformation:props":{"featureSet":"ALL"}}},"SecurityOU":{"id":"SecurityOU","path":"AwsIamSolutionStack/OrgConstruct/SecurityOU","constructInfo":{"fqn":"aws-cdk-lib.aws_organizations.CfnOrganizationalUnit","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Organizations::OrganizationalUnit","aws:cdk:cloudformation:props":{"name":"Security","parentId":{"Fn::GetAtt":["OrgConstructOrganization004880CE","RootId"]}}}},"SharedServicesOU":{"id":"SharedServicesOU","path":"AwsIamSolutionStack/OrgConstruct/SharedServicesOU","constructInfo":{"fqn":"aws-cdk-lib.aws_organizations.CfnOrganizationalUnit","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Organizations::OrganizationalUnit","aws:cdk:cloudformation:props":{"name":"SharedServices","parentId":{"Fn::GetAtt":["OrgConstructOrganization004880CE","RootId"]}}}},"WorkloadsOU":{"id":"WorkloadsOU","path":"AwsIamSolutionStack/OrgConstruct/WorkloadsOU","constructInfo":{"fqn":"aws-cdk-lib.aws_organizations.CfnOrganizationalUnit","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Organizations::OrganizationalUnit","aws:cdk:cloudformation:props":{"name":"Workloads","parentId":{"Fn::GetAtt":["OrgConstructOrganization004880CE","RootId"]}}}},"ProdOU":{"id":"ProdOU","path":"AwsIamSolutionStack/OrgConstruct/ProdOU","constructInfo":{"fqn":"aws-cdk-lib.aws_organizations.CfnOrganizationalUnit","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Organizations::OrganizationalUnit","aws:cdk:cloudformation:props":{"name":"Prod","parentId":{"Ref":"OrgConstructWorkloadsOUBF1F15D2"}}}},"DevOU":{"id":"DevOU","path":"AwsIamSolutionStack/OrgConstruct/DevOU","constructInfo":{"fqn":"aws-cdk-lib.aws_organizations.CfnOrganizationalUnit","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Organizations::OrganizationalUnit","aws:cdk:cloudformation:props":{"name":"Dev","parentId":{"Ref":"OrgConstructWorkloadsOUBF1F15D2"}}}},"SandboxOU":{"id":"SandboxOU","path":"AwsIamSolutionStack/OrgConstruct/SandboxOU","constructInfo":{"fqn":"aws-cdk-lib.aws_organizations.CfnOrganizationalUnit","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Organizations::OrganizationalUnit","aws:cdk:cloudformation:props":{"name":"Sandbox","parentId":{"Ref":"OrgConstructWorkloadsOUBF1F15D2"}}}},"MFAPolicy":{"id":"MFAPolicy","path":"AwsIamSolutionStack/OrgConstruct/MFAPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_organizations.CfnPolicy","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Organizations::Policy","aws:cdk:cloudformation:props":{"content":{"Version":"2012-10-17","Statement":[{"Sid":"RequireMFA","Effect":"Deny","NotAction":["iam:CreateVirtualMFADevice","iam:EnableMFADevice","iam:GetUser","iam:ListMFADevices","iam:ListVirtualMFADevices","iam:ResyncMFADevice","sts:GetSessionToken"],"Resource":"*","Condition":{"BoolIfExists":{"aws:MultiFactorAuthPresent":"false"}}}]},"name":"require-mfa","targetIds":[{"Fn::GetAtt":["OrgConstructOrganization004880CE","RootId"]}],"type":"SERVICE_CONTROL_POLICY"}}},"DenyUnsupportedRegions":{"id":"DenyUnsupportedRegions","path":"AwsIamSolutionStack/OrgConstruct/DenyUnsupportedRegions","constructInfo":{"fqn":"aws-cdk-lib.aws_organizations.CfnPolicy","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Organizations::Policy","aws:cdk:cloudformation:props":{"content":{"Version":"2012-10-17","Statement":[{"Sid":"DenyRegionsNotAllowed","Effect":"Deny","Action":"*","Resource":"*","Condition":{"StringNotEquals":{"aws:RequestedRegion":["us-east-1","us-west-2"]}}}]},"name":"deny-unsupported-regions","targetIds":[{"Fn::GetAtt":["OrgConstructOrganization004880CE","RootId"]}],"type":"SERVICE_CONTROL_POLICY"}}},"ProtectSecurityServices":{"id":"ProtectSecurityServices","path":"AwsIamSolutionStack/OrgConstruct/ProtectSecurityServices","constructInfo":{"fqn":"aws-cdk-lib.aws_organizations.CfnPolicy","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Organizations::Policy","aws:cdk:cloudformation:props":{"content":{"Version":"2012-10-17","Statement":[{"Sid":"DenyDisablingSecurityServices","Effect":"Deny","Action":["cloudtrail:DeleteTrail","cloudtrail:StopLogging","cloudtrail:UpdateTrail","config:DeleteConfigurationRecorder","config:StopConfigurationRecorder","config:DeleteDeliveryChannel","guardduty:DeleteDetector","guardduty:StopMonitoringMembers","access-analyzer:DeleteAnalyzer"],"Resource":"*"}]},"name":"protect-security-services","targetIds":[{"Fn::GetAtt":["OrgConstructOrganization004880CE","RootId"]}],"type":"SERVICE_CONTROL_POLICY"}}},"EnforceMandatoryTags":{"id":"EnforceMandatoryTags","path":"AwsIamSolutionStack/OrgConstruct/EnforceMandatoryTags","constructInfo":{"fqn":"aws-cdk-lib.aws_organizations.CfnPolicy","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Organizations::Policy","aws:cdk:cloudformation:props":{"content":{"Version":"2012-10-17","Statement":[{"Sid":"DenyCreateWithoutTags","Effect":"Deny","Action":["ec2:RunInstances","ec2:Create*","rds:Create*","s3:CreateBucket","lambda:CreateFunction","logs:CreateLogGroup"],"Resource":"*","Condition":{"ForAllValues:StringEqualsIfExists":{"aws:TagKeys":["department","costCenter","environment"]}}}]},"name":"enforce-mandatory-tags","targetIds":[{"Ref":"OrgConstructWorkloadsOUBF1F15D2"}],"type":"SERVICE_CONTROL_POLICY"}}},"DenyRootUser":{"id":"DenyRootUser","path":"AwsIamSolutionStack/OrgConstruct/DenyRootUser","constructInfo":{"fqn":"aws-cdk-lib.aws_organizations.CfnPolicy","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Organizations::Policy","aws:cdk:cloudformation:props":{"content":{"Version":"2012-10-17","Statement":[{"Sid":"DenyRootUser","Effect":"Deny","Action":"*","Resource":"*","Condition":{"StringLike":{"aws:PrincipalArn":"arn:aws:iam::*:root"}}}]},"name":"deny-root-user","targetIds":[{"Fn::GetAtt":["OrgConstructOrganization004880CE","RootId"]}],"type":"SERVICE_CONTROL_POLICY"}}},"OrganizationId":{"id":"OrganizationId","path":"AwsIamSolutionStack/OrgConstruct/OrganizationId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}},"OrganizationRootId":{"id":"OrganizationRootId","path":"AwsIamSolutionStack/OrgConstruct/OrganizationRootId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}},"SecurityOuId":{"id":"SecurityOuId","path":"AwsIamSolutionStack/OrgConstruct/SecurityOuId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}},"SharedServicesOuId":{"id":"SharedServicesOuId","path":"AwsIamSolutionStack/OrgConstruct/SharedServicesOuId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}},"WorkloadsOuId":{"id":"WorkloadsOuId","path":"AwsIamSolutionStack/OrgConstruct/WorkloadsOuId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}},"ProdOuId":{"id":"ProdOuId","path":"AwsIamSolutionStack/OrgConstruct/ProdOuId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}},"DevOuId":{"id":"DevOuId","path":"AwsIamSolutionStack/OrgConstruct/DevOuId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}},"SandboxOuId":{"id":"SandboxOuId","path":"AwsIamSolutionStack/OrgConstruct/SandboxOuId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}}}},"IdentityCenter":{"id":"IdentityCenter","path":"AwsIamSolutionStack/IdentityCenter","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"IdentityCenter":{"id":"IdentityCenter","path":"AwsIamSolutionStack/IdentityCenter/IdentityCenter","constructInfo":{"fqn":"aws-cdk-lib.aws_sso.CfnInstance","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSO::Instance","aws:cdk:cloudformation:props":{"name":"MainIdentityCenter"}}},"ABACAttributes":{"id":"ABACAttributes","path":"AwsIamSolutionStack/IdentityCenter/ABACAttributes","constructInfo":{"fqn":"aws-cdk-lib.aws_sso.CfnInstanceAccessControlAttributeConfiguration","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSO::InstanceAccessControlAttributeConfiguration","aws:cdk:cloudformation:props":{"accessControlAttributes":[{"key":"department","value":{"source":["user.department"]}},{"key":"costCenter","value":{"source":["user.costCenter"]}},{"key":"environment","value":{"source":["user.environment"]}},{"key":"jobFunction","value":{"source":["user.title"]}}],"instanceArn":{"Fn::GetAtt":["IdentityCenter2C71037B","InstanceArn"]}}}},"AdminPermissionSet":{"id":"AdminPermissionSet","path":"AwsIamSolutionStack/IdentityCenter/AdminPermissionSet","constructInfo":{"fqn":"aws-cdk-lib.aws_sso.CfnPermissionSet","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSO::PermissionSet","aws:cdk:cloudformation:props":{"instanceArn":{"Fn::GetAtt":["IdentityCenter2C71037B","InstanceArn"]},"managedPolicies":["arn:aws:iam::aws:policy/AdministratorAccess"],"name":"AdminAccess","sessionDuration":"PT1H"}}},"PowerUserPermissionSet":{"id":"PowerUserPermissionSet","path":"AwsIamSolutionStack/IdentityCenter/PowerUserPermissionSet","constructInfo":{"fqn":"aws-cdk-lib.aws_sso.CfnPermissionSet","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSO::PermissionSet","aws:cdk:cloudformation:props":{"instanceArn":{"Fn::GetAtt":["IdentityCenter2C71037B","InstanceArn"]},"managedPolicies":["arn:aws:iam::aws:policy/PowerUserAccess"],"name":"PowerUserAccess","sessionDuration":"PT2H"}}},"ReadOnlyPermissionSet":{"id":"ReadOnlyPermissionSet","path":"AwsIamSolutionStack/IdentityCenter/ReadOnlyPermissionSet","constructInfo":{"fqn":"aws-cdk-lib.aws_sso.CfnPermissionSet","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSO::PermissionSet","aws:cdk:cloudformation:props":{"instanceArn":{"Fn::GetAtt":["IdentityCenter2C71037B","InstanceArn"]},"managedPolicies":["arn:aws:iam::aws:policy/ReadOnlyAccess"],"name":"ReadOnlyAccess","sessionDuration":"PT8H"}}},"DeveloperPermissionSet":{"id":"DeveloperPermissionSet","path":"AwsIamSolutionStack/IdentityCenter/DeveloperPermissionSet","constructInfo":{"fqn":"aws-cdk-lib.aws_sso.CfnPermissionSet","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSO::PermissionSet","aws:cdk:cloudformation:props":{"inlinePolicy":{"Version":"2012-10-17","Statement":[{"Sid":"AllowTaggingForOwnership","Effect":"Allow","Action":["ec2:CreateTags","ec2:DeleteTags","s3:PutBucketTagging","lambda:TagResource","lambda:UntagResource"],"Resource":"*","Condition":{"ForAllValues:StringEquals":{"aws:TagKeys":["department","environment"]},"StringEquals":{"aws:RequestTag/department":"${aws:PrincipalTag/department}","aws:RequestTag/environment":"${aws:PrincipalTag/environment}"}}},{"Sid":"AllowS3PerDept","Effect":"Allow","Action":["s3:ListAllMyBuckets","s3:ListBucket","s3:GetObject","s3:PutObject","s3:DeleteObject"],"Resource":"*","Condition":{"StringEquals":{"aws:ResourceTag/department":"${aws:PrincipalTag/department}","aws:ResourceTag/environment":"${aws:PrincipalTag/environment}"}}},{"Sid":"DescribeOnly","Effect":"Allow","Action":["ec2:Describe*","rds:Describe*","cloudwatch:Get*","cloudwatch:List*"],"Resource":"*"}]},"instanceArn":{"Fn::GetAtt":["IdentityCenter2C71037B","InstanceArn"]},"managedPolicies":["arn:aws:iam::aws:policy/CloudWatchReadOnlyAccess","arn:aws:iam::aws:policy/AWSCloudFormationReadOnlyAccess"],"name":"DeveloperAccess","sessionDuration":"PT4H"}}},"IdentityCenterArn":{"id":"IdentityCenterArn","path":"AwsIamSolutionStack/IdentityCenter/IdentityCenterArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}},"AdminPermissionSetArn":{"id":"AdminPermissionSetArn","path":"AwsIamSolutionStack/IdentityCenter/AdminPermissionSetArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}},"PowerUserPermissionSetArn":{"id":"PowerUserPermissionSetArn","path":"AwsIamSolutionStack/IdentityCenter/PowerUserPermissionSetArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}},"ReadOnlyPermissionSetArn":{"id":"ReadOnlyPermissionSetArn","path":"AwsIamSolutionStack/IdentityCenter/ReadOnlyPermissionSetArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}},"DeveloperPermissionSetArn":{"id":"DeveloperPermissionSetArn","path":"AwsIamSolutionStack/IdentityCenter/DeveloperPermissionSetArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.220.0"}}}},"IAMMonitoring":{"id":"IAMMonitoring","path":"AwsIamSolutionStack/IAMMonitoring","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"OrgAccessAnalyzer":{"id":"OrgAccessAnalyzer","path":"AwsIamSolutionStack/IAMMonitoring/OrgAccessAnalyzer","constructInfo":{"fqn":"aws-cdk-lib.aws_accessanalyzer.CfnAnalyzer","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AccessAnalyzer::Analyzer","aws:cdk:cloudformation:props":{"analyzerName":"org-analyzer","type":"ORGANIZATION"}}},"CloudTrailLogGroup":{"id":"CloudTrailLogGroup","path":"AwsIamSolutionStack/IAMMonitoring/CloudTrailLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.220.0","metadata":[{"removalPolicy":"destroy","retention":731}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/CloudTrailLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"retentionInDays":731}}}}},"CloudTrailBucket":{"id":"CloudTrailBucket","path":"AwsIamSolutionStack/IAMMonitoring/CloudTrailBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.220.0","metadata":[{"blockPublicAccess":"*","encryption":"S3_MANAGED","enforceSSL":true,"versioned":true}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/CloudTrailBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"AES256"}}]},"publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true},"versioningConfiguration":{"status":"Enabled"}}}},"Policy":{"id":"Policy","path":"AwsIamSolutionStack/IAMMonitoring/CloudTrailBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.220.0","metadata":[{"bucket":"*"}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/CloudTrailBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"IAMMonitoringCloudTrailBucketE4948AC7"},"policyDocument":{"Statement":[{"Action":"s3:*","Condition":{"Bool":{"aws:SecureTransport":"false"}},"Effect":"Deny","Principal":{"AWS":"*"},"Resource":[{"Fn::GetAtt":["IAMMonitoringCloudTrailBucketE4948AC7","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["IAMMonitoringCloudTrailBucketE4948AC7","Arn"]},"/*"]]}]},{"Action":"s3:GetBucketAcl","Effect":"Allow","Principal":{"Service":"cloudtrail.amazonaws.com"},"Resource":{"Fn::GetAtt":["IAMMonitoringCloudTrailBucketE4948AC7","Arn"]}},{"Action":"s3:PutObject","Condition":{"StringEquals":{"s3:x-amz-acl":"bucket-owner-full-control"}},"Effect":"Allow","Principal":{"Service":"cloudtrail.amazonaws.com"},"Resource":{"Fn::Join":["",[{"Fn::GetAtt":["IAMMonitoringCloudTrailBucketE4948AC7","Arn"]},"/AWSLogs/",{"Ref":"AWS::AccountId"},"/*"]]}},{"Action":"s3:PutObject","Condition":{"StringEquals":{"s3:x-amz-acl":"bucket-owner-full-control","aws:SourceArn":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":cloudtrail:",{"Ref":"AWS::Region"},":",{"Ref":"AWS::AccountId"},":trail/undefined"]]}}},"Effect":"Allow","Principal":{"Service":"cloudtrail.amazonaws.com"},"Resource":{"Fn::Join":["",[{"Fn::GetAtt":["IAMMonitoringCloudTrailBucketE4948AC7","Arn"]},"/AWSLogs/undefined/*"]]}}],"Version":"2012-10-17"}}}}}}}},"OrganizationTrail":{"id":"OrganizationTrail","path":"AwsIamSolutionStack/IAMMonitoring/OrganizationTrail","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudtrail.Trail","version":"2.220.0","metadata":[{"bucket":"*","cloudWatchLogGroup":"*","includeGlobalServiceEvents":true,"isMultiRegionTrail":true,"isOrganizationTrail":true,"sendToCloudWatchLogs":true},{"logAllLambdaDataEvents":["*"]},{"addEventSelector":["AWS::Lambda::Function",["*"],"*"]},{"logAllS3DataEvents":["*"]},{"addEventSelector":["AWS::S3::Object",["*"],"*"]}]},"children":{"LogsRole":{"id":"LogsRole","path":"AwsIamSolutionStack/IAMMonitoring/OrganizationTrail/LogsRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.220.0","metadata":[{"assumedBy":{"principalAccount":"*","assumeRoleAction":"*"}},{"addToPrincipalPolicy":[{}]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]}]},"children":{"ImportLogsRole":{"id":"ImportLogsRole","path":"AwsIamSolutionStack/IAMMonitoring/OrganizationTrail/LogsRole/ImportLogsRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.220.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/OrganizationTrail/LogsRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"cloudtrail.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AwsIamSolutionStack/IAMMonitoring/OrganizationTrail/LogsRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.220.0","metadata":["*",{"attachToRole":["*"]},{"attachToRole":["*"]},{"addStatements":[{}]}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/OrganizationTrail/LogsRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":{"Fn::GetAtt":["IAMMonitoringCloudTrailLogGroupABAB51AF","Arn"]}}],"Version":"2012-10-17"},"policyName":"IAMMonitoringOrganizationTrailLogsRoleDefaultPolicy044460F8","roles":[{"Ref":"IAMMonitoringOrganizationTrailLogsRole3475DDD4"}]}}}}}}},"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/OrganizationTrail/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudtrail.CfnTrail","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudTrail::Trail","aws:cdk:cloudformation:props":{"cloudWatchLogsLogGroupArn":{"Fn::GetAtt":["IAMMonitoringCloudTrailLogGroupABAB51AF","Arn"]},"cloudWatchLogsRoleArn":{"Fn::GetAtt":["IAMMonitoringOrganizationTrailLogsRole3475DDD4","Arn"]},"enableLogFileValidation":true,"eventSelectors":[{"dataResources":[{"type":"AWS::Lambda::Function","values":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":lambda"]]}]}]},{"dataResources":[{"type":"AWS::S3::Object","values":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":s3:::"]]}]}]}],"includeGlobalServiceEvents":true,"isLogging":true,"isMultiRegionTrail":true,"isOrganizationTrail":true,"s3BucketName":{"Ref":"IAMMonitoringCloudTrailBucketE4948AC7"}}}}}},"ConsoleSignInFailureFilter":{"id":"ConsoleSignInFailureFilter","path":"AwsIamSolutionStack/IAMMonitoring/ConsoleSignInFailureFilter","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.MetricFilter","version":"2.220.0","metadata":[{"filterPattern":{"logPatternString":"*"},"metricName":"*","metricNamespace":"*","metricValue":"*","logGroup":"*"},{"metric":["*"]}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/ConsoleSignInFailureFilter/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnMetricFilter","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::MetricFilter","aws:cdk:cloudformation:props":{"filterPattern":"{ ($.eventName = ConsoleLogin) && ($.errorMessage = \"Failed authentication\") }","logGroupName":{"Ref":"IAMMonitoringCloudTrailLogGroupABAB51AF"},"metricTransformations":[{"metricNamespace":"Security/IAM","metricName":"ConsoleSignInFailureCount","metricValue":"1"}]}}}}},"ConsoleSignInFailureAlarm":{"id":"ConsoleSignInFailureAlarm","path":"AwsIamSolutionStack/IAMMonitoring/ConsoleSignInFailureAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.220.0","metadata":[{"evaluationPeriods":"*","threshold":"*","datapointsToAlarm":"*","treatMissingData":"notBreaching","metric":{"warnings":"*","warningsV2":"*"}}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/ConsoleSignInFailureAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"comparisonOperator":"GreaterThanOrEqualToThreshold","datapointsToAlarm":1,"evaluationPeriods":1,"metricName":"ConsoleSignInFailureCount","namespace":"Security/IAM","period":300,"statistic":"Average","threshold":5,"treatMissingData":"notBreaching"}}}}},"RootUsageFilter":{"id":"RootUsageFilter","path":"AwsIamSolutionStack/IAMMonitoring/RootUsageFilter","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.MetricFilter","version":"2.220.0","metadata":[{"filterPattern":{"logPatternString":"*"},"metricName":"*","metricNamespace":"*","metricValue":"*","logGroup":"*"},{"metric":["*"]}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/RootUsageFilter/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnMetricFilter","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::MetricFilter","aws:cdk:cloudformation:props":{"filterPattern":"{ ($.userIdentity.type = \"Root\") && ($.eventType != \"AwsServiceEvent\") }","logGroupName":{"Ref":"IAMMonitoringCloudTrailLogGroupABAB51AF"},"metricTransformations":[{"metricNamespace":"Security/IAM","metricName":"RootUsageCount","metricValue":"1"}]}}}}},"RootUsageAlarm":{"id":"RootUsageAlarm","path":"AwsIamSolutionStack/IAMMonitoring/RootUsageAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.220.0","metadata":[{"evaluationPeriods":"*","threshold":"*","datapointsToAlarm":"*","treatMissingData":"breaching","metric":{"warnings":"*","warningsV2":"*"}}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/RootUsageAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"comparisonOperator":"GreaterThanOrEqualToThreshold","datapointsToAlarm":1,"evaluationPeriods":1,"metricName":"RootUsageCount","namespace":"Security/IAM","period":300,"statistic":"Average","threshold":1,"treatMissingData":"breaching"}}}}},"OrgRuleCloudTrailEnabled":{"id":"OrgRuleCloudTrailEnabled","path":"AwsIamSolutionStack/IAMMonitoring/OrgRuleCloudTrailEnabled","constructInfo":{"fqn":"aws-cdk-lib.aws_config.CfnOrganizationConfigRule","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Config::OrganizationConfigRule","aws:cdk:cloudformation:props":{"organizationConfigRuleName":"org-cloud_trail_enabled","organizationManagedRuleMetadata":{"ruleIdentifier":"CLOUD_TRAIL_ENABLED"}}}},"OrgRuleIamUserMfaEnabled":{"id":"OrgRuleIamUserMfaEnabled","path":"AwsIamSolutionStack/IAMMonitoring/OrgRuleIamUserMfaEnabled","constructInfo":{"fqn":"aws-cdk-lib.aws_config.CfnOrganizationConfigRule","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Config::OrganizationConfigRule","aws:cdk:cloudformation:props":{"organizationConfigRuleName":"org-iam_user_mfa_enabled","organizationManagedRuleMetadata":{"ruleIdentifier":"IAM_USER_MFA_ENABLED"}}}},"OrgRuleRootMfaEnabled":{"id":"OrgRuleRootMfaEnabled","path":"AwsIamSolutionStack/IAMMonitoring/OrgRuleRootMfaEnabled","constructInfo":{"fqn":"aws-cdk-lib.aws_config.CfnOrganizationConfigRule","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Config::OrganizationConfigRule","aws:cdk:cloudformation:props":{"organizationConfigRuleName":"org-root_account_mfa_enabled","organizationManagedRuleMetadata":{"ruleIdentifier":"ROOT_ACCOUNT_MFA_ENABLED"}}}},"OrgRuleS3PublicReadProhibited":{"id":"OrgRuleS3PublicReadProhibited","path":"AwsIamSolutionStack/IAMMonitoring/OrgRuleS3PublicReadProhibited","constructInfo":{"fqn":"aws-cdk-lib.aws_config.CfnOrganizationConfigRule","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Config::OrganizationConfigRule","aws:cdk:cloudformation:props":{"organizationConfigRuleName":"org-s3_bucket_public_read_prohibited","organizationManagedRuleMetadata":{"ruleIdentifier":"S3_BUCKET_PUBLIC_READ_PROHIBITED"}}}},"OrgRuleS3PublicWriteProhibited":{"id":"OrgRuleS3PublicWriteProhibited","path":"AwsIamSolutionStack/IAMMonitoring/OrgRuleS3PublicWriteProhibited","constructInfo":{"fqn":"aws-cdk-lib.aws_config.CfnOrganizationConfigRule","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Config::OrganizationConfigRule","aws:cdk:cloudformation:props":{"organizationConfigRuleName":"org-s3_bucket_public_write_prohibited","organizationManagedRuleMetadata":{"ruleIdentifier":"S3_BUCKET_PUBLIC_WRITE_PROHIBITED"}}}},"RemediationFunction":{"id":"RemediationFunction","path":"AwsIamSolutionStack/IAMMonitoring/RemediationFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.220.0","metadata":[{"timeout":"*","code":"*","handler":"*","runtime":"*"}]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AwsIamSolutionStack/IAMMonitoring/RemediationFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.220.0","metadata":[{"assumedBy":{"principalAccount":"*","assumeRoleAction":"*"},"managedPolicies":[{"managedPolicyArn":"*"}]},{"addToPrincipalPolicy":[{}]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]}]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AwsIamSolutionStack/IAMMonitoring/RemediationFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.220.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/RemediationFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AwsIamSolutionStack/IAMMonitoring/RemediationFunction/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.220.0","metadata":["*",{"attachToRole":["*"]},{"attachToRole":["*"]},{"addStatements":[{}]}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/RemediationFunction/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetBucketPolicy","s3:GetBucketPublicAccessBlock","s3:ListAllMyBuckets","s3:PutBucketPolicy","s3:PutBucketPublicAccessBlock"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"IAMMonitoringRemediationFunctionServiceRoleDefaultPolicy5246534B","roles":[{"Ref":"IAMMonitoringRemediationFunctionServiceRole189403C2"}]}}}}}}},"Code":{"id":"Code","path":"AwsIamSolutionStack/IAMMonitoring/RemediationFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.220.0"},"children":{"Stage":{"id":"Stage","path":"AwsIamSolutionStack/IAMMonitoring/RemediationFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.220.0"}},"AssetBucket":{"id":"AssetBucket","path":"AwsIamSolutionStack/IAMMonitoring/RemediationFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.220.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/RemediationFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":{"Fn::Sub":"cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"},"s3Key":"c79ecccc4fb7a2271abcfca2302eebe67b725b6b7678edb7a74ad055941b3a79.zip"},"handler":"index.handler","role":{"Fn::GetAtt":["IAMMonitoringRemediationFunctionServiceRole189403C2","Arn"]},"runtime":"python3.11","timeout":300}}},"LogGroup":{"id":"LogGroup","path":"AwsIamSolutionStack/IAMMonitoring/RemediationFunction/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.220.0","metadata":[{"logGroupName":"*"}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/RemediationFunction/LogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":{"Fn::Join":["",["/aws/lambda/",{"Ref":"IAMMonitoringRemediationFunctionB51F51EB"}]]},"retentionInDays":731}}}}}}},"AccessAnalyzerFindings":{"id":"AccessAnalyzerFindings","path":"AwsIamSolutionStack/IAMMonitoring/AccessAnalyzerFindings","constructInfo":{"fqn":"aws-cdk-lib.aws_events.Rule","version":"2.220.0","metadata":[{"eventPattern":{"detailType":"*","source":"*"},"targets":"*"},{"addEventPattern":[{"detailType":"*","source":"*"}]},{"addTarget":[{}]}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/AccessAnalyzerFindings/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_events.CfnRule","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Events::Rule","aws:cdk:cloudformation:props":{"eventPattern":{"detail-type":["Access Analyzer Finding"],"source":["aws.access-analyzer"]},"state":"ENABLED","targets":[{"id":"Target0","arn":{"Fn::GetAtt":["IAMMonitoringRemediationFunctionB51F51EB","Arn"]}}]}}},"AllowEventRuleAwsIamSolutionStackIAMMonitoringRemediationFunction34811B25":{"id":"AllowEventRuleAwsIamSolutionStackIAMMonitoringRemediationFunction34811B25","path":"AwsIamSolutionStack/IAMMonitoring/AccessAnalyzerFindings/AllowEventRuleAwsIamSolutionStackIAMMonitoringRemediationFunction34811B25","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["IAMMonitoringRemediationFunctionB51F51EB","Arn"]},"principal":"events.amazonaws.com","sourceArn":{"Fn::GetAtt":["IAMMonitoringAccessAnalyzerFindings17149C8E","Arn"]}}}}}},"CredentialRotationFunction":{"id":"CredentialRotationFunction","path":"AwsIamSolutionStack/IAMMonitoring/CredentialRotationFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.220.0","metadata":[{"timeout":"*","code":"*","handler":"*","runtime":"*"}]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AwsIamSolutionStack/IAMMonitoring/CredentialRotationFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.220.0","metadata":[{"assumedBy":{"principalAccount":"*","assumeRoleAction":"*"},"managedPolicies":[{"managedPolicyArn":"*"}]},{"addToPrincipalPolicy":[{}]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]}]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AwsIamSolutionStack/IAMMonitoring/CredentialRotationFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.220.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/CredentialRotationFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AwsIamSolutionStack/IAMMonitoring/CredentialRotationFunction/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.220.0","metadata":["*",{"attachToRole":["*"]},{"attachToRole":["*"]},{"addStatements":[{}]}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/CredentialRotationFunction/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["iam:ListAccessKeys","iam:ListUsers","iam:UpdateAccessKey"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"IAMMonitoringCredentialRotationFunctionServiceRoleDefaultPolicy846DD474","roles":[{"Ref":"IAMMonitoringCredentialRotationFunctionServiceRoleD1307106"}]}}}}}}},"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/CredentialRotationFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nimport boto3, datetime, json\niam = boto3.client('iam')\n\ndef handler(event, context):\n    paginator = iam.get_paginator('list_users')\n    now = datetime.datetime.now(datetime.timezone.utc)\n    disabled = []\n    for page in paginator.paginate():\n        for user in page['Users']:\n            access_keys = iam.list_access_keys(UserName=user['UserName']).get('AccessKeyMetadata', [])\n            for key in access_keys:\n                age_days = (now - key['CreateDate']).days\n                if age_days > 90 and key['Status'] == 'Active':\n                    iam.update_access_key(UserName=user['UserName'], AccessKeyId=key['AccessKeyId'], Status='Inactive')\n                    disabled.append({'user': user['UserName'], 'key': key['AccessKeyId'], 'ageDays': age_days})\n    print(json.dumps({'disabled': disabled}))\n    return {'disabledCount': len(disabled)}\n                "},"handler":"index.handler","role":{"Fn::GetAtt":["IAMMonitoringCredentialRotationFunctionServiceRoleD1307106","Arn"]},"runtime":"python3.11","timeout":300}}},"LogGroup":{"id":"LogGroup","path":"AwsIamSolutionStack/IAMMonitoring/CredentialRotationFunction/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.220.0","metadata":[{"logGroupName":"*"}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/CredentialRotationFunction/LogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":{"Fn::Join":["",["/aws/lambda/",{"Ref":"IAMMonitoringCredentialRotationFunction767382B8"}]]},"retentionInDays":731}}}}}}},"DailyCredentialRotation":{"id":"DailyCredentialRotation","path":"AwsIamSolutionStack/IAMMonitoring/DailyCredentialRotation","constructInfo":{"fqn":"aws-cdk-lib.aws_events.Rule","version":"2.220.0","metadata":[{"schedule":"*","targets":"*"},{"addEventPattern":["*"]},{"addTarget":[{}]}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/DailyCredentialRotation/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_events.CfnRule","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Events::Rule","aws:cdk:cloudformation:props":{"scheduleExpression":"cron(0 3 * * ? *)","state":"ENABLED","targets":[{"id":"Target0","arn":{"Fn::GetAtt":["IAMMonitoringCredentialRotationFunction767382B8","Arn"]}}]}}},"AllowEventRuleAwsIamSolutionStackIAMMonitoringCredentialRotationFunctionA8F40901":{"id":"AllowEventRuleAwsIamSolutionStackIAMMonitoringCredentialRotationFunctionA8F40901","path":"AwsIamSolutionStack/IAMMonitoring/DailyCredentialRotation/AllowEventRuleAwsIamSolutionStackIAMMonitoringCredentialRotationFunctionA8F40901","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["IAMMonitoringCredentialRotationFunction767382B8","Arn"]},"principal":"events.amazonaws.com","sourceArn":{"Fn::GetAtt":["IAMMonitoringDailyCredentialRotation0C3EC33E","Arn"]}}}}}},"JitGrantFunction":{"id":"JitGrantFunction","path":"AwsIamSolutionStack/IAMMonitoring/JitGrantFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.220.0","metadata":[{"timeout":"*","code":"*","handler":"*","runtime":"*"}]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AwsIamSolutionStack/IAMMonitoring/JitGrantFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.220.0","metadata":[{"assumedBy":{"principalAccount":"*","assumeRoleAction":"*"},"managedPolicies":[{"managedPolicyArn":"*"}]}]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AwsIamSolutionStack/IAMMonitoring/JitGrantFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.220.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/JitGrantFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}}}},"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/JitGrantFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nimport json\n\ndef handler(event, context):\n    # Placeholder: integrate with sso-admin to provision a temporary assignment\n    # Record ticket/reference for audit\n    print(json.dumps(event))\n    return {'granted': True}\n                "},"handler":"index.handler","role":{"Fn::GetAtt":["IAMMonitoringJitGrantFunctionServiceRole14D04436","Arn"]},"runtime":"python3.11","timeout":300}}},"LogGroup":{"id":"LogGroup","path":"AwsIamSolutionStack/IAMMonitoring/JitGrantFunction/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.220.0","metadata":[{"logGroupName":"*"}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/JitGrantFunction/LogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":{"Fn::Join":["",["/aws/lambda/",{"Ref":"IAMMonitoringJitGrantFunction411CE6DF"}]]},"retentionInDays":731}}}}}}},"JitRevokeFunction":{"id":"JitRevokeFunction","path":"AwsIamSolutionStack/IAMMonitoring/JitRevokeFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.220.0","metadata":[{"timeout":"*","code":"*","handler":"*","runtime":"*"}]},"children":{"ServiceRole":{"id":"ServiceRole","path":"AwsIamSolutionStack/IAMMonitoring/JitRevokeFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.220.0","metadata":[{"assumedBy":{"principalAccount":"*","assumeRoleAction":"*"},"managedPolicies":[{"managedPolicyArn":"*"}]}]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"AwsIamSolutionStack/IAMMonitoring/JitRevokeFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.220.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/JitRevokeFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}}}},"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/JitRevokeFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nimport json\n\ndef handler(event, context):\n    # Placeholder: remove temporary assignment via sso-admin\n    print(json.dumps(event))\n    return {'revoked': True}\n                "},"handler":"index.handler","role":{"Fn::GetAtt":["IAMMonitoringJitRevokeFunctionServiceRoleABD5E557","Arn"]},"runtime":"python3.11","timeout":300}}},"LogGroup":{"id":"LogGroup","path":"AwsIamSolutionStack/IAMMonitoring/JitRevokeFunction/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.220.0","metadata":[{"logGroupName":"*"}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/JitRevokeFunction/LogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":{"Fn::Join":["",["/aws/lambda/",{"Ref":"IAMMonitoringJitRevokeFunction05D0ECE1"}]]},"retentionInDays":731}}}}}}},"ManagerApproved":{"id":"ManagerApproved","path":"AwsIamSolutionStack/IAMMonitoring/ManagerApproved","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Pass","version":"2.220.0"}},"GrantTempAccess":{"id":"GrantTempAccess","path":"AwsIamSolutionStack/IAMMonitoring/GrantTempAccess","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.LambdaInvoke","version":"2.220.0"}},"WaitDuration":{"id":"WaitDuration","path":"AwsIamSolutionStack/IAMMonitoring/WaitDuration","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Wait","version":"2.220.0"}},"RevokeAccess":{"id":"RevokeAccess","path":"AwsIamSolutionStack/IAMMonitoring/RevokeAccess","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.LambdaInvoke","version":"2.220.0"}},"JitAccessStateMachine":{"id":"JitAccessStateMachine","path":"AwsIamSolutionStack/IAMMonitoring/JitAccessStateMachine","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.StateMachine","version":"2.220.0","metadata":[{"definition":{"id":"*","startState":"*","endStates":"*"},"timeout":"*"},{"addToRolePolicy":[{}]},{"addToRolePolicy":[{}]}]},"children":{"Role":{"id":"Role","path":"AwsIamSolutionStack/IAMMonitoring/JitAccessStateMachine/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.220.0","metadata":[{"assumedBy":{"principalAccount":"*","assumeRoleAction":"*"}},{"addToPrincipalPolicy":[{}]},{"attachInlinePolicy":["*"]},{"attachInlinePolicy":["*"]},{"addToPrincipalPolicy":[{}]}]},"children":{"ImportRole":{"id":"ImportRole","path":"AwsIamSolutionStack/IAMMonitoring/JitAccessStateMachine/Role/ImportRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.220.0","metadata":["*"]}},"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/JitAccessStateMachine/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"states.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"AwsIamSolutionStack/IAMMonitoring/JitAccessStateMachine/Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.220.0","metadata":["*",{"attachToRole":["*"]},{"attachToRole":["*"]},{"addStatements":[{}]},{"addStatements":[{}]}]},"children":{"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/JitAccessStateMachine/Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["IAMMonitoringJitGrantFunction411CE6DF","Arn"]},{"Fn::GetAtt":["IAMMonitoringJitRevokeFunction05D0ECE1","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["IAMMonitoringJitGrantFunction411CE6DF","Arn"]},":*"]]},{"Fn::Join":["",[{"Fn::GetAtt":["IAMMonitoringJitRevokeFunction05D0ECE1","Arn"]},":*"]]}]}],"Version":"2012-10-17"},"policyName":"IAMMonitoringJitAccessStateMachineRoleDefaultPolicy254FB9D8","roles":[{"Ref":"IAMMonitoringJitAccessStateMachineRoleB247E9E4"}]}}}}}}},"Resource":{"id":"Resource","path":"AwsIamSolutionStack/IAMMonitoring/JitAccessStateMachine/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.CfnStateMachine","version":"2.220.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::StepFunctions::StateMachine","aws:cdk:cloudformation:props":{"definitionString":{"Fn::Join":["",["{\"StartAt\":\"ManagerApproved\",\"States\":{\"ManagerApproved\":{\"Type\":\"Pass\",\"Next\":\"GrantTempAccess\"},\"GrantTempAccess\":{\"Next\":\"WaitDuration\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"OutputPath\":\"$.Payload\",\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"",{"Fn::GetAtt":["IAMMonitoringJitGrantFunction411CE6DF","Arn"]},"\",\"Payload.$\":\"$\"}},\"WaitDuration\":{\"Type\":\"Wait\",\"Seconds\":1800,\"Next\":\"RevokeAccess\"},\"RevokeAccess\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"OutputPath\":\"$.Payload\",\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::lambda:invoke\",\"Parameters\":{\"FunctionName\":\"",{"Fn::GetAtt":["IAMMonitoringJitRevokeFunction05D0ECE1","Arn"]},"\",\"Payload.$\":\"$\"}}},\"TimeoutSeconds\":7200}"]]},"roleArn":{"Fn::GetAtt":["IAMMonitoringJitAccessStateMachineRoleB247E9E4","Arn"]}}}}}}}},"CDKMetadata":{"id":"CDKMetadata","path":"AwsIamSolutionStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"AwsIamSolutionStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.220.0"}},"Condition":{"id":"Condition","path":"AwsIamSolutionStack/CDKMetadata/Condition","constructInfo":{"fqn":"aws-cdk-lib.CfnCondition","version":"2.220.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"AwsIamSolutionStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.220.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"AwsIamSolutionStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.220.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}